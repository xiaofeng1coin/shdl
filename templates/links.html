{% extends "base.html" %}
{% block content %}
    <h1>管理链接</h1>
    <form method="POST">
        <input type="url" name="original_url" placeholder="长链接" required>
        <input type="text" name="custom_suffix" placeholder="自定义后缀（可选）">
        <button type="submit">创建</button>
    </form>
    
    <table>
        <tr>
            <th>短链接</th>
            <th>原始链接</th>
            <th>点击量</th>
            <th>创建日期</th>
            <th>操作</th>
        </tr>
        {% for link in links %}
        <tr>
            <td><a href="{{ base_url }}{{ link.short_code }}">{{ base_url }}{{ link.short_code }}</a></td>
            <td>{{ link.original_url }}</td>
            <td>{{ link.clicks }}</td>
            <td>{{ link.created_at.strftime('%Y-%m-%d') }}</td>
            <td>
                <button onclick="copyToClipboard('{{ base_url }}{{ link.short_code }}')">复制</button>
                <a href="{{ url_for('link_stats', short_code=link.short_code) }}" class="btn">统计</a>
            </td>
        </tr>
        {% endfor %}
    </table>
    
    <script>
        function copyToClipboard(text) {
            if (navigator.clipboard && window.isSecureContext) {
                // 使用 navigator.clipboard API 复制文本
                navigator.clipboard.writeText(text)
                   .then(() => {
                        alert('已复制: ' + text);
                    })
                   .catch((error) => {
                        console.error('复制文本失败: ', error);
                        fallbackCopyTextToClipboard(text);
                    });
            } else {
                // 使用旧的 document.execCommand 方法作为替代
                fallbackCopyTextToClipboard(text);
            }
        }

        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    alert('已复制: ' + text);
                } else {
                    console.error('使用 document.execCommand 复制文本失败');
                }
            } catch (err) {
                console.error('复制文本时出错: ', err);
            }

            document.body.removeChild(textArea);
        }
    </script>
{% endblock %}