{% extends "base.html" %}
{% block content %}
    <h1 style="font-size: 24px;">管理短链</h1> <!-- 将字号调小 -->
    <form method="POST" class="links-form">
        <input type="url" name="original_url" placeholder="长链接" required>
        <input type="text" name="custom_suffix" placeholder="自定义后缀（可选）">
        <button type="submit" class="links-create-btn">创建</button>
    </form>

    <table class="links-table">
        <tr>
            <th>短链接</th>
            <th>原始链接</th>
            <th>点击量</th>
            <th>创建日期</th>
            <th>操作</th>
        </tr>
        {% for link in links %}
        <tr data-short-code="{{ link.short_code }}">
    <td><a href="{{ base_url }}{{ link.short_code }}" class="links-short-url">{{ base_url }}{{ link.short_code }}</a></td>
    <td>{{ link.original_url }}</td>
    <td>{{ link.clicks }}</td>
    <td>{{ link.created_at.strftime('%Y-%m-%d') }}</td>
    <td>
        <button onclick="copyToClipboard('{{ base_url }}{{ link.short_code }}')" class="links-copy-btn">复制</button>
        <a href="{{ url_for('link_stats', short_code=link.short_code) }}" class="links-stats-btn">统计</a>
        <button onclick="deleteLink('{{ link.short_code }}')" class="links-delete-btn">删除</button>
    </td>
</tr>
        {% endfor %}
    </table>
    <script>
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text);
        alert('已复制: ' + text);
    }

    function deleteLink(shortCode) {
    if (confirm("确定要删除这个短链接吗？")) {
        fetch("{{ url_for('delete_link') }}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ short_code: shortCode })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('短链接已删除');
                // 动态移除对应的行
                const row = document.querySelector(`tr[data-short-code="${shortCode}"]`);
                if (row) {
                    row.remove();
                }
            } else {
                alert('删除失败: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('删除失败');
        });
    }
}
    </script>
{% endblock %}